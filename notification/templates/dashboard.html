<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NOAA Alerts Dashboard</title>
    <!-- Bootstrap 5 CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <meta http-equiv="refresh" content="300"> <!-- Refresh every 5 mins -->
</head>
<body>
<!-- Navbar/Header -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">NOAA Alerts Dashboard</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav">
                {% if user.is_authenticated %}
                    <li class="nav-item">
                        <a class="nav-link" href="#">{{ user.username }}</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'logout' %}">Logout</a>
                    </li>
                {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'login' %}">Login</a>
                    </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

<div class="container my-5">
    <!-- Filters -->
    <form method="get" class="row g-3 mb-4">
        <div class="col-md-4">
            <label for="area" class="form-label">Area</label>
            <input type="text" class="form-control" name="area" id="area" value="{{ request.GET.area }}">
        </div>
        <div class="col-md-4">
            <label for="severity" class="form-label">Severity</label>
            <select class="form-select" name="severity" id="severity">
                <option value="">All</option>
                <option value="Severe" {% if request.GET.severity == 'Severe' %}selected{% endif %}>Severe</option>
                <option value="Moderate" {% if request.GET.severity == 'Moderate' %}selected{% endif %}>Moderate</option>
                <option value="Minor" {% if request.GET.severity == 'Minor' %}selected{% endif %}>Minor</option>
            </select>
        </div>
        <div class="col-md-4">
            <label for="urgency" class="form-label">Urgency</label>
            <select class="form-select" name="urgency" id="urgency">
                <option value="">All</option>
                <option value="Immediate" {% if request.GET.urgency == 'Immediate' %}selected{% endif %}>Immediate</option>
                <option value="Expected" {% if request.GET.urgency == 'Expected' %}selected{% endif %}>Expected</option>
                <option value="Future" {% if request.GET.urgency == 'Future' %}selected{% endif %}>Future</option>
                <option value="Past" {% if request.GET.urgency == 'Past' %}selected{% endif %}>Past</option>
                <option value="Unknown" {% if request.GET.urgency == 'Unknown' %}selected{% endif %}>Unknown</option>
            </select>
        </div>
        <div class="col-12 text-end">
            <button type="submit" class="btn btn-primary mt-3">Filter</button>
            <a href="{% url 'dashboard' %}" class="btn btn-secondary mt-3">Reset</a>
        </div>
    </form>

    <!-- Alerts Table -->
    {% if alerts %}
        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead class="table-dark">
                    <tr>
                        <th scope="col">Event</th>
                        <th scope="col">Area</th>
                        <th scope="col">Severity</th>
                        <th scope="col">Urgency</th>
                        <th scope="col">Sent</th>
                        <th scope="col">Expires</th>
                        <th scope="col">Description</th>
                        <th scope="col">Link</th>
                    </tr>
                </thead>
                <tbody>
                    {% for alert in alerts %}
                    <tr class="{% if alert.severity|lower == 'severe' %}table-danger{% elif alert.severity|lower == 'moderate' %}table-warning{% elif alert.severity|lower == 'minor' %}table-info{% endif %}">
                        <td>{{ alert.event }}</td>
                        <td>{{ alert.area_desc }}</td>
                        <td>{{ alert.severity }}</td>
                        <td>{{ alert.urgency }}</td>
                        <td>{{ alert.sent|date:"Y-m-d H:i" }}</td>
                        <td>{{ alert.expires|date:"Y-m-d H:i" }}</td>
                        <td>{{ alert.description }}</td>
                        <td>
                            {% if alert.parameters.URL %}
                                <a href="{{ alert.parameters.URL }}" target="_blank" class="btn btn-sm btn-primary">View Alert</a>
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="alert alert-success" role="alert">
            No active alerts at this time.
        </div>
    {% endif %}
</div>

<!-- Bootstrap JS (optional for interactivity) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
